<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>原生 confirm</title>
    <link rel="stylesheet" href="./confirm.css">
</head>
<body>
    <div id="app">

    </div>
    <script src="../../../../js/vue.js"></script>
    <script>

        var messageBox = {
            data() {
                return {
                    isShowMessageBox: false,
                    resolve: '',
                    reject: '',
                    promise: '', // 保存promise对象
                }
            },
            template: `
                <div class="dialog_views" v-show="isShowMessageBox" @touchmove.prevent>
                    <div class="UImask" @click="cancel"></div>
                    <transition name="confirm-fade">
                    <div class="UIdialog" v-show="isShowMessageBox">
                        <div class="UIdialog_hd">{{title}}</div>
                        <div class="UIdialog_bd">
                        <slot>{{content}}</slot>
                        </div>
                        <div :class="[ isShowCancelBtn ? 'UIdialog_ft' : 'UIdialog_ft UIdialog_ft_one']">
                        <span v-if="isShowCancelBtn" class="UIdialog_btn" @click="cancel">{{cancelVal}}</span>
                        <span v-if="isShowConfimrBtn" class="UIdialog_btn" @click="confirm">{{confirmVal}}</span>
                        </div>

                    </div>
                    </transition>
                </div>
            `,
            props: {
                isShowConfimrBtn: {
                    type: Boolean,
                    default: true
                },
                content: {
                    type: String,
                    default: '这是弹框内容'
                },
                isShowCancelBtn: {  //是否展示取消按钮
                    type: Boolean,
                    default: true
                },
                title: {   //标题
                    type: String,
                    default: '提示',
                },
                confirmVal: {
                    type: String,  //确认文字
                    default: '确定'
                },
                cancelVal: {   //取消文字
                    type: String,
                    default: '取消'
                },
                maskHide: {
                    type: Boolean,   //是否可以点击蒙层关闭
                    default: true
                }
            },
            methods: {
                // 确定,将promise断定为resolve状态
                confirm() {
                    this.isShowMessageBox = false;
                    this.resolve('confirm');
                    this.remove();
                },
                // 取消,将promise断定为reject状态
                cancel() {
                    this.isShowMessageBox = false;
                    this.reject('cancel');
                    this.remove();
                },
                // 弹出messageBox,并创建promise对象
                showMsgBox() {
                    this.isShowMessageBox = true;
                    this.promise = new Promise((resolve, reject) => {
                        this.resolve = resolve;
                        this.reject = reject;
                    });
                    // 返回promise对象
                    return this.promise;
                },
                remove() {
                    setTimeout(() => {
                        this.destroy();
                    }, 100);
                },
                destroy() {
                    this.$destroy();
                    document.body.removeChild(this.$el);
                },
            }
        }
        const MessageBox = {};
        // vue的install方法，用于定义vue插件
        MessageBox.install = function (Vue, options) {
        const MessageBoxInstance = Vue.extend(msgboxVue);
        let currentMsg;
        const initInstance = () => {
            // 实例化vue实例
            currentMsg = new MessageBoxInstance();
            let msgBoxEl = currentMsg.$mount().$el;
            document.body.appendChild(msgBoxEl);
        };
        // 在Vue的原型上添加实例方法，以全局调用
        Vue.prototype.$msgBox = {
            showMsgBox (options) {
            if (!currentMsg) {
                initInstance();
            }
            if (typeof options === 'string') {
                currentMsg.content = options;
            } else if (typeof options === 'object') {
                Object.assign(currentMsg, options);
            }
            //  Object.assign方法只会拷贝源对象自身的并且可枚举的属性到目标对象
            return currentMsg.showMsgBox()
                .then(val => {
                currentMsg = null;
                return Promise.resolve(val);
                })
                .catch(err => {
                currentMsg = null;
                return Promise.reject(err);
                });
            }
        };
        };

        Vue.use(messageBox)

        new Vue({
            el: '#app',
            data() {
                return {
                    
                }
            },
            mounted() {
    //             this.$msgBox.showMsgBox({
    //     title: '提示',
    //     content: '确定要删除吗',
    //   }).then(async (val) => {
    //     // ...        
    //     console.log('确认')
    //   }).catch(() => {
    //     // ...
    //     console.log('取消')
    //   });
    //         }
    console.log(
        this.messageBox,
        this.$messageBox,
    )
            }
        })
    </script>
</body>
</html>