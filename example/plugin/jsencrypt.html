<!doctype html>
<html>
  <head>
    <title>JavaScript RSA Encryption</title>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../jsencrypt/bin/jsencrypt.js"></script>
    <script type="text/javascript">

      // Call this code when the page is done loading.
      $(function() {

        // Run a quick encryption/decryption when they click.
        $('#testme').click(function() {
          // debugger
          // Encrypt with the public key...
          var encrypt = new JSEncrypt();
          console.log(
            $('#pubkey').val()
          )
          encrypt.setPublicKey($('#pubkey').val());
          var encrypted = encrypt.encrypt(
            $('#input').val()
          );
          var a = encrypted

          console.log(
            a
          )

          // Decrypt with the private key...
          // 用私钥解密

          var decrypt = new JSEncrypt();
          decrypt.setPrivateKey($('#privkey').val());
          console.log(decrypt)
          var uncrypted = decrypt.decrypt(encrypted);

          // Now a simple check to see if the round-trip worked.
          console.log(
            uncrypted,
          )
          console.log(
            $('#input').val()
          )

          if (uncrypted == $('#input').val()) {
            alert('It works!!!');
          }
          else {
            alert('Something went wrong....');
          }
        });
      });
    </script>
  </head>
  <body>
    <label for="privkey">Private Key</label><br/>
    <textarea id="privkey" rows="15" cols="65">
        -----BEGIN PUBLIC KEY-----
                MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC9/YsdhH2LmdxWMrlyad6IqvVM
                kAs/5vnOAYOZyu+S9vjNSlUmh0ItjcPKMNxoSgyrcD1XCl1sAXjkee7b0CY0iMN8
                Hs+AJpaDs7pjJNkSx8WkruqtQIcfvMQ964rPrJUiDOq0e+Ym5HQvAw/wbj7JQwbE
                x/Ww8sc4qQYBcciwywIDAQAB
        -----END PUBLIC KEY-----
    </textarea><br/>
    <label for="pubkey">Public Key</label><br/>
    <textarea id="pubkey" rows="15" cols="65">
      -----BEGIN PUBLIC KEY-----
      MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC9/YsdhH2LmdxWMrlyad6IqvVM
      kAs/5vnOAYOZyu+S9vjNSlUmh0ItjcPKMNxoSgyrcD1XCl1sAXjkee7b0CY0iMN8
      Hs+AJpaDs7pjJNkSx8WkruqtQIcfvMQ964rPrJUiDOq0e+Ym5HQvAw/wbj7JQwbE
      x/Ww8sc4qQYBcciwywIDAQAB
      -----END PUBLIC KEY-----
    </textarea><br/>
    <label for="input">Text to encrypt:</label><br/>
    <textarea id="input" name="input" type="text" rows=4 cols=70>iLcepMCVbP1Md5u3</textarea><br/>
    <input id="testme" type="button" value="Test Me!!!" /><br/>

    <script>
      /**
       * RSA加密
       * @param str
       * @returns {*}
       */
      function cmdRSAEncrypt (str){
          let key = `-----BEGIN PUBLIC KEY-----
                MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC9/YsdhH2LmdxWMrlyad6IqvVM
                kAs/5vnOAYOZyu+S9vjNSlUmh0ItjcPKMNxoSgyrcD1XCl1sAXjkee7b0CY0iMN8
                Hs+AJpaDs7pjJNkSx8WkruqtQIcfvMQ964rPrJUiDOq0e+Ym5HQvAw/wbj7JQwbE
                x/Ww8sc4qQYBcciwywIDAQAB
                -----END PUBLIC KEY-----`,
                Encrypt = new JSEncrypt();
          Encrypt.setPublicKey(key);
          return Encrypt.encrypt(str);
      }

      console.log(
        cmdRSAEncrypt('iLcepMCVbP1Md5u3'), '什么鬼'
      )

      function qyzx(nbxh,url,ff){
          // 获取公钥
          var publicKey = `-----BEGIN PUBLIC KEY-----
                          MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC9/YsdhH2LmdxWMrlyad6IqvVM
                          kAs/5vnOAYOZyu+S9vjNSlUmh0ItjcPKMNxoSgyrcD1XCl1sAXjkee7b0CY0iMN8
                          Hs+AJpaDs7pjJNkSx8WkruqtQIcfvMQ964rPrJUiDOq0e+Ym5HQvAw/wbj7JQwbE
                          x/Ww8sc4qQYBcciwywIDAQAB
                          -----END PUBLIC KEY-----`;
          // 创建加密实例
            var jsencrypt = new JSEncrypt();

          // 初始化公钥
            jsencrypt.setPublicKey(publicKey);
            // 加密数据
            nbxh =jsencrypt.encrypt(nbxh);
            
            console.log(nbxh, '加密数据')

          var e = document.createElement("a");

          e.href = url+"xxxx.do?method="+ff+"&nbxh="+nbxh+"&bqz=hz";

          // document.body.appendChild(e);

          // e.click();
        }
        qyzx('iLcepMCVbP1Md5u3');

  </script>
  </body>
</html>